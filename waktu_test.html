<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AdminMatematika</title>
    <link rel="icon" type="image/x-icon" href="assets/image/logo_mate.jpg" />
    <link rel="stylesheet" href="assets/css/custom.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <!--Main Navigation-->
    <header>
      <!-- Sidebar -->
      <nav
        id="sidebarMenu"
        class="collapse d-lg-block sidebar collapse bg-white"
      >
        <div class="position-sticky">
          <div class="list-group list-group-flush mx-3 mt-4">
            <a
              href="index.html"
              class="list-group-item list-group-item-action py-2 ripple"
              aria-current="true"
            >
              <i class="fas fa-tachometer-alt fa-fw me-3"></i><span>Home</span>
            </a>
            <a
              href="bank_soal.html"
              class="list-group-item list-group-item-action py-2 ripple"
              style="border: none"
            >
              <i class="fas fa-solid fa-book fa-fw me-3"></i
              ><span>Bank Soal</span>
            </a>
            <a
              href="tambah_soal.html"
              class="list-group-item list-group-item-action py-2 ripple"
              ><i class="fas fa-plus-circle fa-fw me-3"></i
              ><span>Tambah Soal</span></a
            >

            <a
              href="ranking.html"
              class="list-group-item list-group-item-action py-2 ripple"
              style="border: none"
              ><i class="fas fa-chart-line fa-fw me-3"></i
              ><span>Ranking</span></a
            >

            <a class="list-group-item list-group-item-action py-2 ripple active"
              ><i class="fas fa-solid fa-users fa-fw me-3"></i
              ><span>User Management</span></a
            >
          </div>
        </div>
      </nav>
      <!-- Sidebar -->

      <!-- Navbar -->
      <nav
        id="main-navbar"
        class="navbar navbar-expand-lg navbar-light bg-white fixed-top"
        style="box-shadow: 0px 1px 10px rgba(0, 0, 0, 0.1)"
      >
        <!-- Container wrapper -->
        <div class="container-fluid">
          <!-- Toggle button -->
          <button
            class="navbar-toggler"
            type="button"
            data-mdb-toggle="collapse"
            data-mdb-target="#sidebarMenu"
            aria-controls="sidebarMenu"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i class="fas fa-bars"></i>
          </button>

          <!-- Brand -->
          <a class="navbar-brand" href="#">
            <img
              src="assets/image/logo_mate.jpg"
              height="40"
              style="border-radius: 5px"
              alt="Logo"
              loading="lazy"
            />
          </a>
          <!-- Search form -->
          <!-- <form class="d-none d-md-flex input-group w-auto my-auto">
        <input autocomplete="off" type="search" class="form-control rounded"
          placeholder='Search (ctrl + "/" to focus)' style="min-width: 225px;" />
        <span class="input-group-text border-0"><i class="fas fa-search"></i></span>
      </form> -->

          <!-- Right links -->
          <ul class="navbar-nav ms-auto d-flex flex-row">
            <!-- Notification dropdown -->
            <div
              style="
                display: flex;
                justify-content: center;
                align-items: center;
                padding-right: 10px;
              "
            >
              <span style="text-align: center">Admin</span>
            </div>

            <!-- Avatar -->
            <li class="nav-item dropdown" style="margin-bottom: 0px !important">
              <a
                class="nav-link dropdown-toggle hidden-arrow d-flex align-items-center"
                href="#"
                id="navbarDropdownMenuLink"
                role="button"
                data-mdb-toggle="dropdown"
                aria-expanded="false"
              >
                <img
                  src="https://disk.mediaindonesia.com/files/news/2022/11/03/wa9.jpg"
                  class="rounded-circle"
                  height="22"
                  alt="Avatar"
                  loading="lazy"
                />
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="navbarDropdownMenuLink"
                style="left: -140px"
              >
                <!-- <li>
                  <a class="dropdown-item" href="#">My profile</a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">Settings</a>
                </li> -->
                <li>
                  <a class="dropdown-item" href="#" id="logoutButton">Logout</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
        <!-- Container wrapper -->
      </nav>
      <!-- Navbar -->
    </header>
    <!--Main Navigation-->

    <main style="margin-top: 58px">
      <div class="container pt-4" style="text-align: left !important">
        <div class="my-3">
          <div class="card">
            <div class="card-body">
              <h3>User Management</h3>
            </div>
          </div>
        </div>

        <!-- Dropdown untuk memilih jumlah soal -->

        <div class="dropdown">
          <label for="questionCount">Pilih Jumlah User:</label>
          <select id="questionCount">
            <option value="10">10 Soal</option>
            <option value="50">50 Soal</option>
            <option value="100">100 Soal</option>
            <option value="200">200 Soal</option>
          </select>

          <!-- <button id="tambah_user">Tambah User</button> -->
        </div>

        <table class="table">
          <thead>
            <th scope="col">No</th>
            <th scope="col">Nama</th>
            <th scope="col">Email</th>
            <th scope="col">Hapus</th>
            <th scope="col">Edit</th>

            <!-- <th scope="col">Edit</th>
            <th scope="col">Delete</th> -->
          </thead>
          <tbody id="tbody1"></tbody>
        </table>

        <!-- Tombol "Previous" dan "Next" untuk navigasi halaman soal -->
        <div class="pagination">
          <button id="prevButton" disabled>Previous</button>
          <span id="currentPage">Halaman 1</span>
          <button id="nextButton">Next</button>
        </div>
      </div>
    </main>

    <script>
      // Membuat fungsi logout
      function logout() {
        firebase
          .auth()
          .signOut()
          .then(() => {
            // Logout berhasil, hapus informasi autentikasi dari LocalStorage
            localStorage.removeItem("userId");
            // Redirect atau lakukan tindakan lain, misalnya, arahkan ke halaman login
            window.location.replace("login.html");
          })
          .catch((error) => {
            // Handle error
          });
      }

      // Panggil fungsi logout saat pengguna mengklik tombol logout atau tautan logout
      document.getElementById("logoutButton").addEventListener("click", logout);
    </script>

    <script>
      // Ambil elemen dropdown
      const dropdownToggle = document.getElementById("navbarDropdownMenuLink");

      // Tambahkan event listener untuk mengaktifkan dropdown
      dropdownToggle.addEventListener("click", function () {
        const dropdownMenu = this.nextElementSibling;
        if (dropdownMenu.style.display === "block") {
          dropdownMenu.style.display = "none";
        } else {
          dropdownMenu.style.display = "block";
        }
      });

      // Tambahkan event listener untuk menutup dropdown saat mengklik di luar dropdown
      document.addEventListener("click", function (e) {
        if (!dropdownToggle.contains(e.target)) {
          const dropdownMenus = document.querySelectorAll(".dropdown-menu");
          dropdownMenus.forEach(function (menu) {
            menu.style.display = "none";
          });
        }
      });
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCEP9xiVWHYg4oXcqIoImbgb0ma_Dhd55U",
        authDomain: "mastermatematika-91bae.firebaseapp.com",
        databaseURL:
          "https://mastermatematika-91bae-default-rtdb.firebaseio.com",
        projectId: "mastermatematika-91bae",
        storageBucket: "mastermatematika-91bae.appspot.com",
        messagingSenderId: "609139117081",
        appId: "1:609139117081:web:092ab7a617518799d2ae88",
      };

      firebase.initializeApp(firebaseConfig);
      let db = firebase.firestore();

      const userId = localStorage.getItem("userId");
      if (userId) {
        // Pengguna sudah login, lakukan tindakan yang sesuai
      } else {
        // Pengguna belum login, arahkan ke halaman login
        window.location.replace("login.html");
      }

      // Definisikan variabel tambahan
      let currentPage = 1;
      let questionsPerPage = 10; // Jumlah soal per halaman (default: 10)
      let currentQuestionNumber = 1;

      // Tambahkan event listener untuk dropdown
      const questionCountSelect = document.getElementById("questionCount");
      questionCountSelect.addEventListener("change", () => {
        questionsPerPage = parseInt(questionCountSelect.value);
        currentPage = 1;
        GetAllDataOnce(); // Memuat data ulang dengan jumlah soal yang baru
      });

      // Tambahkan event listener untuk tombol "Previous" dan "Next"
      const prevButton = document.getElementById("prevButton");
      const nextButton = document.getElementById("nextButton");
      prevButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          GetAllDataOnce(); // Memuat data ulang dengan halaman sebelumnya
        }
      });
      nextButton.addEventListener("click", () => {
        currentPage++;
        GetAllDataOnce(); // Memuat data ulang dengan halaman selanjutnya
      });

      //   getData
      function GetAllDataOnce() {
        // Hitung indeks awal dan akhir untuk mengambil sejumlah soal sesuai halaman
        const startIndex = (currentPage - 1) * questionsPerPage;
        const endIndex = startIndex + questionsPerPage;

        // Memperbarui status tombol "Previous"
        prevButton.disabled = currentPage === 1;

        db.collection("LATIHAN")
          .doc("5bH7DElxluSiNFiqUFlU") // Ganti "LATIHAN_ID" dengan ID dokumen yang sesuai
          .collection("TESTS_LIST")
          .doc("TEST_INFO")
          .get()
          .then((querySnapshot) => {
            var questions = [];
            if (querySnapshot.exists) {
              const testInfoData = querySnapshot.data();
              // Mengakses nilai "TEST1_ID"
              const test1Id = testInfoData.TEST1_ID;

              const testtime1 = testInfoData.TEST1_TIME;

              // Menambahkan data ke array "questions"
              questions.push({
                TEST1_ID: test1Id,
                TEST1_TIME: testtime1,
              });
            } else {
              console.log("Dokumen tidak ditemukan.");
            }

            // Filter data sesuai indeks awal dan akhir
            const filteredQuestions = questions.slice(startIndex, endIndex);
            AddAllItemsToTheTable(filteredQuestions);

            // Memeriksa apakah ada lebih banyak data
            nextButton.disabled = endIndex >= questions.length;
          });
      }

      // Di dalam GetAllDataOnce
      function AddAllItemsToTheTable(SoalDocsList) {
        currentQuestionNumber = (currentPage - 1) * questionsPerPage; // Mengatur nomor pertanyaan saat mengganti halaman
        soalNo = 0;
        tbody.innerHTML = "";
        SoalDocsList.forEach((element) => {
          AddItemToTable(
            element.TEST1_ID,
            element.TEST1_TIME,
            element.TEST1_TIME,
            element.TEST1_TIME
          );
        });

        // Update teks "Halaman" dengan nomor halaman saat ini
        document.getElementById(
          "currentPage"
        ).innerText = `Halaman ${currentPage}`;
      }

      //    isitabel
      var soalNo = 0;
      var tbody = document.getElementById("tbody1");

      function AddItemToTable(nama, email, id, id) {
        var trow = document.createElement("tr");
        var td1 = document.createElement("td");
        var td2 = document.createElement("td");
        var td3 = document.createElement("td");
        var td4 = document.createElement("td");
        var td5 = document.createElement("td");

        currentQuestionNumber++; // Menambah nomor pertanyaan saat menambahkan ke tabel
        td1.innerHTML = currentQuestionNumber;
        td2.innerHTML = nama;
        td3.innerHTML = email;

        // Tombol Hapus
        var deleteButton = document.createElement("button");
        deleteButton.innerHTML = "Hapus";
        deleteButton.classList.add("delete-button"); // Menambahkan kelas CSS
        deleteButton.setAttribute("data-id", id);
        deleteButton.addEventListener("click", function () {
          // Panggil fungsi untuk menghapus data berdasarkan ID dokumen
          const documentId = this.getAttribute("data-id");
          deleteData(documentId);
        });

        function deleteData(documentId) {
          if (confirm("Apakah Anda yakin ingin menghapus soal ini?")) {
            // Hapus data dari Firestore berdasarkan nilai "QUESTION" yang sesuai
            db.collection("USERS")
              .where("EMAIL", "==", documentId) // Membandingkan nilai "QUESTION" dengan documentId
              .get()
              .then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                  doc.ref.delete().then(() => {
                    // Tampilkan pesan sukses atau lakukan tindakan lain yang sesuai
                    alert("users berhasil dihapus");
                    // Muat ulang data setelah penghapusan
                    GetAllDataOnce();
                  });
                });
              })
              .catch((error) => {
                console.error("Gagal menghapus soal: ", error);
                // Tampilkan pesan kesalahan atau lakukan tindakan lain yang sesuai
                alert("Gagal menghapus soal");
              });
          }
        }

        // Tombol Edit
        var editButton = document.createElement("button");
        editButton.innerHTML = "Edit";
        editButton.classList.add("edit-button");
        deleteButton.setAttribute("data-id", id); // Menambahkan kelas CSS
        editButton.setAttribute("data-id", id);
        editButton.addEventListener("click", function () {
          // Dapatkan Document ID dari atribut data-id
          const documentId = this.getAttribute("data-id");

          // Arahkan ke halaman edit_soal.html dengan mengirim Document ID melalui query parameter
          window.location.href = `edit_user.html?documentId=${documentId}`;
        });

        td4.appendChild(deleteButton);
        td5.appendChild(editButton);

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);

        tbody.appendChild(trow);
      }

      window.onload = GetAllDataOnce;
    </script>
  </body>
</html>
